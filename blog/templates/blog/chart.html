<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue + Plotly 혼합 차트</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 24px; }
        .container { max-width: 960px; margin: 0 auto; }
        #chart { width: 100%; height: 480px; }
        .controls { margin-bottom: 16px; display: flex; gap: 8px; align-items: center; }
        button { padding: 6px 12px; }
    </style>
    {% load static %}
</head>
<body>
<div id="app" class="container">
    <h1>Vue + Plotly 혼합형 차트(막대 + 선)</h1>
    <div class="controls">
        <button @click="reload">데이터 새로고침</button>
        <span v-if="loading">불러오는 중...</span>
    </div>
    <div id="chart"></div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      loading: false,
      apiUrl: "{% url 'chart_data' %}",
    };
  },
  methods: {
    async fetchData() {
      this.loading = true;
      try {
        const res = await fetch(this.apiUrl, { headers: { 'Accept': 'application/json' } });
        const data = await res.json();

        const barTrace = {
          type: 'bar',
          x: data.labels,
          y: data.bar.values,
          name: data.bar.name,
          marker: { color: '#3b82f6' }
        };

        const lineTrace = {
          type: 'scatter',
          mode: 'lines+markers',
          x: data.labels,
          y: data.line.values,
          name: data.line.name,
          line: { color: '#ef4444', width: 3 },
          marker: { size: 6 }
        };

        const layout = {
          barmode: 'group',
          margin: { t: 40, r: 20, b: 40, l: 48 },
          legend: { orientation: 'h', x: 0, y: 1.15 },
          xaxis: { title: '월' },
          yaxis: { title: '값' },
          hovermode: 'x unified'
        };

        Plotly.newPlot('chart', [barTrace, lineTrace], layout, { displayModeBar: true, responsive: true });
      } catch (e) {
        console.error(e);
        alert('데이터를 불러오는 중 오류가 발생했습니다.');
      } finally {
        this.loading = false;
      }
    },
    reload() {
      this.fetchData();
    }
  },
  mounted() {
    this.fetchData();
    window.addEventListener('resize', () => Plotly.Plots.resize('chart'));
  }
}).mount('#app');
</script>
</body>
</html>


